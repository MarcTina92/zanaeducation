import{a3 as O,k as D,r as E,b as M,Q as A,q as n,s as y,x,y as v,v as b,H as F,I,D as j,E as N,A as m,C as d,a4 as U,a5 as B,J as _,M as z,a6 as L,a7 as T,a8 as G,a9 as H,aa as J,ab as Q}from"./frappe-ui.7c282ee9.js";import{c as q}from"./index.17f95304.js";import{s as K}from"./index.f7ba6e79.js";const W={class:"flex flex-col gap-4"},X={class:"grid grid-cols-2 gap-4"},Y={class:"mb-2 text-sm text-gray-600"},Z={class:"flex flex-row-reverse gap-2"},ee={__name:"FeesPaymentDialog",props:{modelValue:{type:Boolean,required:!1},student:{type:Object,required:!0},row:{type:Object,required:!0}},emits:["update:modelValue","success"],setup(g,{emit:P}){const s=g,$=P;O(()=>{const t=document.createElement("script");t.src="https://checkout.razorpay.com/v1/checkout.js",document.body.appendChild(t)});const p=D({url:"education.education.billing.get_payment_options",makeParams(t){return{doctype:"Sales Invoice",docname:s.row.invoice,phone:e.mobile_number,country:e.country}}}),f=D({url:"education.education.billing.handle_payment_success"}),h=D({url:"education.education.billing.handle_payment_failure"});function S(t){if(!e.mobile_number||!e.email){k();return}p.submit({},{onSuccess(a){a.handler=c=>{V(c,t)};let u=new Razorpay(a);u.open(),u.on("payment.failed",c=>R(c)),u.on("payment.success",c=>V(c,t))},onError(a){w(a)}})}function k(){e.mobile_number||(o.value=!1),e.email||(i.value=!1),e.mobile_number&&!e.email&&(o.value=!0,i.value=!1),e.email&&!e.mobile_number&&(i.value=!0,o.value=!1),e.email&&e.mobile_number&&(i.value=!0,o.value=!0)}function V(t,a){f.submit({response:t,against_invoice:s.row.invoice,billing_details:e},{onSuccess(u){a(),$("success")},onError(u){w(u)}})}function R(t){h.submit({response:t,against_invoice:s.row.invoice,billing_details:e},{onError(a){w(a)}})}function w(t){console.log(t),q({message:"Something went wrong",icon:"x",iconClasses:"text-red-600"})}const o=E(!0),i=E(!0),e=M({program:s.row.program||"",student:s.student.student_name||"",amount:s.row.amount||"",id:s.student.name||"",mobile_number:"",email:s.student.student_email_id||"",address_line_1:s.student.address_line_1||"",address_line_2:s.student.address_line_2||"",city:s.student.city||"",state:s.student.state||"",country:s.student.country||"",pincode:s.student.pincode||""}),r=[{section:"Student Details",fields:[{label:"Student",name:"student",type:"data",readonly:!0},{label:"Student",name:"id",type:"data",readonly:!0},{label:"Amount",name:"amount",type:"data",readonly:!0},{label:"Program",name:"program",type:"data",readonly:!0},{label:"Mobile Number",name:"mobile_number",type:"data"},{label:"Email",name:"email",type:"data"}]},{section:"Student Address",fields:[{label:"Address Line 1",name:"address_line_1",type:"data"},{label:"Address Line 2",name:"address_line_2",type:"data"},{label:"City",name:"city",type:"data"},{label:"State",name:"state",type:"data"},{label:"Country",name:"country",type:"data"},{label:"Pincode",name:"pincode",type:"data"}]}];return(t,a)=>{const u=A("Button");return n(),y("div",null,[x(d(z),{options:{title:"Pay Fees",actions:[{label:"Save",variant:"solid"}]},modelValue:g.modelValue,"onUpdate:modelValue":a[2]||(a[2]=c=>$("update:modelValue",c))},{"body-content":v(()=>[b("div",W,[(n(),y(F,null,I(r,c=>b("div",{key:c.section},[b("div",X,[(n(!0),y(F,null,I(c.fields,l=>(n(),y("div",{key:l.name,class:j(l.hidden&&"hidden")},[b("div",Y,N(l.label),1),l.name==="mobile_number"||l.name==="email"?(n(),m(d(U),{key:0,type:l.type,modelValue:e[l.name],"onUpdate:modelValue":C=>e[l.name]=C,placeholder:l.placeholder,disabled:l.readonly,onChange:a[0]||(a[0]=C=>k())},null,8,["type","modelValue","onUpdate:modelValue","placeholder","disabled"])):(n(),m(d(U),{key:1,type:l.type,modelValue:e[l.name],"onUpdate:modelValue":C=>e[l.name]=C,placeholder:l.placeholder,disabled:l.readonly,onChange:a[1]||(a[1]=C=>k())},null,8,["type","modelValue","onUpdate:modelValue","placeholder","disabled"])),l.name==="mobile_number"&&!o.value?(n(),m(d(B),{key:2,message:"Mobile number is required",class:"pt-2"})):_("",!0),l.name==="email"&&!i.value?(n(),m(d(B),{key:3,message:"Email is Required",class:"pt-2"})):_("",!0)],2))),128))])])),64))])]),actions:v(({close:c})=>[b("div",Z,[x(u,{class:"w-48 h-7",variant:"solid",onClick:l=>S(c),"icon-left":"external-link",loading:d(p).loading,label:"Proceed to Payment"},null,8,["onClick","loading"])])]),_:1},8,["modelValue"])])}}},te={class:"flex items-center justify-center h-[250px]"},ae={class:"text-gray-500"},ne={__name:"MissingData",props:{message:{type:String,default:"No data found"}},setup(g){return(P,s)=>(n(),y("div",te,[b("p",ae,N(g.message),1)]))}},oe={key:0,class:"px-5 py-4"},se={key:1},ue={__name:"Fees",setup(g){const{getStudentInfo:P}=K();let s=P().value;const $=D({url:"education.education.api.get_student_invoices",params:{student:s.name},onSuccess:o=>{S=o==null?void 0:o.print_format;let i=o==null?void 0:o.invoices;i=i.sort((e,r)=>{const t={Overdue:0,Unpaid:1,Paid:2},a=t[e.status],u=t[r.status];if(a!==u)return a-u}),p.rows=i},auto:!0}),p=M({rows:[],columns:[{label:"Program",key:"program",width:1},{label:"Status",key:"status",width:1},{label:"Payment Date",key:"payment_date",width:1},{label:"Due Date",key:"due_date",width:1},{label:"Amount",key:"amount",width:1},{label:"Invoice",key:"cta",width:1}]}),f=E(null),h=E(!1);let S="Standard";const k=o=>{let i=`/api/method/frappe.utils.print_format.download_pdf?
		doctype=${encodeURIComponent("Sales Invoice")}
		&name=${encodeURIComponent(o.invoice)}
		&format=${encodeURIComponent(S)}
	`;window.open(i,"_blank")},V=o=>{f.value=o,h.value=!0},R=()=>{$.reload(),q({title:"Payment successful",icon:"check",iconClasses:"text-green-600"})},w=o=>({Paid:"green",Unpaid:"red",Overdue:"red","Partly Paid":"orange"})[o];return(o,i)=>{const e=A("Button");return p.rows.length>0?(n(),y("div",oe,[p.rows.length>0?(n(),m(d(T),{key:0,columns:p.columns,rows:p.rows,options:{selectable:!1,showTooltip:!1,onRowClick:()=>{}},"row-key":"id"},{default:v(()=>[x(d(L),null,{default:v(()=>[(n(!0),y(F,null,I(p.columns,r=>(n(),m(d(G),{key:r.key,item:r},null,8,["item"]))),128))]),_:1}),(n(!0),y(F,null,I(p.rows,r=>(n(),m(d(H),{key:r.id,row:r},{default:v(({column:t,item:a})=>[x(d(J),{item:a,align:t.align},{default:v(()=>[t.key==="status"?(n(),m(d(Q),{key:0,variant:"subtle",theme:w(r.status)||"gray",size:"md",label:a},null,8,["theme","label"])):_("",!0),t.key==="cta"&&r.status==="Paid"?(n(),m(e,{key:1,onClick:u=>k(r),class:"hover:bg-gray-900 hover:text-white","icon-left":"download",label:"Download Invoice"},null,8,["onClick"])):_("",!0),t.key==="cta"&&r.status!=="Paid"?(n(),m(e,{key:2,onClick:u=>V(r),class:"hover:bg-gray-900 hover:text-white flex flex-column items-center justify-center","icon-left":"credit-card",label:"Pay Now"},null,8,["onClick"])):_("",!0)]),_:2},1032,["item","align"])]),_:2},1032,["row"]))),128))]),_:1},8,["columns","rows"])):_("",!0),f.value?(n(),m(ee,{key:1,row:f.value,student:d(s),modelValue:h.value,"onUpdate:modelValue":i[0]||(i[0]=r=>h.value=r),onSuccess:i[1]||(i[1]=r=>R())},null,8,["row","student","modelValue"])):_("",!0)])):(n(),y("div",se,[x(ne,{message:"No Fees found"})]))}}};export{ue as default};
